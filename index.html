<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Código - Sistema de Prazos</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <style>
        :root { --primary: #0ea5e9; --dark: #0f172a; --text: #f8fafc; }
        
        body { 
            margin: 0; font-family: 'Inter', sans-serif; 
            background-color: var(--dark); color: var(--text);
            display: flex; height: 100vh; overflow: hidden;
        }

        /* Sidebar */
        .sidebar { width: 250px; background: #020617; display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #1e293b; }
        .nav-item { 
            padding: 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer;
            color: #94a3b8; transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .nav-item:hover { background: #1e293b; color: white; }
        .nav-item.active { background: var(--primary); color: white; }

        /* Area Principal */
        .content { flex: 1; padding: 30px; position: relative; overflow-y: auto; }
        .tab-panel { display: none; width: 100%; }
        .tab-panel.active { display: block; }

        /* CALENDÁRIO - SEGURANÇA DE LAYOUT */
        #calendar-wrapper { 
            background: white; /* Fundo branco para garantir contraste */
            border-radius: 12px; 
            padding: 20px;
            min-height: 700px; /* Altura mínima forçada para não sumir */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* Forçar visibilidade dos textos do calendário */
        .fc { color: #1e293b !important; max-height: 800px; }
        .fc-toolbar-title { font-weight: bold; color: #0f172a !important; }
        .fc-daygrid-day-number { color: #0f172a !important; padding: 5px !important; }

        .btn-new {
            background: var(--primary); color: white; border: none;
            padding: 10px 20px; border-radius: 6px; cursor: pointer;
            font-weight: bold; margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2 style="color: var(--primary); margin-bottom: 30px;">Learn Código</h2>
        <div class="nav-item active" onclick="changeTab('home', this)"><i class="fas fa-home"></i> Início</div>
        <div class="nav-item" onclick="changeTab('calendar-tab', this)"><i class="fas fa-calendar-check"></i> Meu Calendário</div>
        <div class="nav-item" onclick="location.reload()" style="margin-top: auto; color: #f43f5e;"><i class="fas fa-sync"></i> Recarregar App</div>
    </aside>

    <main class="content">
        <div id="home" class="tab-panel active">
            <h1>Workspace Ativo</h1>
            <p>Clique no menu ao lado para abrir o calendário de longo prazo.</p>
        </div>

        <div id="calendar-tab" class="tab-panel">
            <button class="btn-new" onclick="manualAdd()">+ Adicionar Compromisso</button>
            <div id="calendar-wrapper">
                <div id="calendar"></div>
            </div>
        </div>
    </main>

    <script>
        let calendar;
        const DB_KEY = 'learn_codigo_events_v3';

        // 1. Inicialização Segura
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                // Carrega eventos salvos
                events: JSON.parse(localStorage.getItem(DB_KEY) || '[]'),
                
                // FUNÇÃO: ADICIONAR (Clique no dia)
                dateClick: function(info) {
                    const title = prompt("O que você quer agendar para " + info.dateStr + "?");
                    if (title) {
                        calendar.addEvent({
                            title: title,
                            start: info.dateStr,
                            allDay: true,
                            backgroundColor: '#0ea5e9'
                        });
                        saveToLocal();
                    }
                },

                // FUNÇÃO: APAGAR (Clique no evento)
                eventClick: function(info) {
                    if (confirm("Deseja apagar o evento: '" + info.event.title + "'?")) {
                        info.event.remove();
                        saveToLocal();
                    }
                }
            });
        });

        // 2. Troca de aba com "Force Render"
        function changeTab(tabId, element) {
            // Esconde tudo
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            
            // Mostra o atual
            document.getElementById(tabId).classList.add('active');
            element.classList.add('active');

            // Se for o calendário, forçar o desenho na tela
            if (tabId === 'calendar-tab') {
                setTimeout(() => {
                    calendar.render();
                    calendar.updateSize();
                }, 50);
            }
        }

        // 3. Persistência de Dados
        function saveToLocal() {
            const allEvents = calendar.getEvents().map(e => ({
                title: e.title,
                start: e.startStr,
                allDay: e.allDay
            }));
            localStorage.setItem(DB_KEY, JSON.stringify(allEvents));
        }

        // 4. Backup: Adição via Botão
        function manualAdd() {
            const title = prompt("Título do plano:");
            const date = prompt("Data (AAAA-MM-DD):", new Date().toISOString().split('T')[0]);
            if (title && date) {
                calendar.addEvent({ title: title, start: date, allDay: true });
                saveToLocal();
            }
        }
    </script>
</body>
</html>